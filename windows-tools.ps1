# Allow all execution in this script
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass -Force

# Install Visual Studio Using Gui
Invoke-WebRequest -Uri "https://download.visualstudio.microsoft.com/download/pr/3a7354bc-d2e4-430f-92d0-9abd031b5ee5/d9fc228ea71a98adc7bc5f5d8e8800684c647e955601ed721fcb29f74ace7536/vs_Community.exe
" -OutFile ".\vs_community.exe"
.\vs_community.exe
Remove-Item .\vs_community.exe

# Install BurpSuite
curl.exe -L "https://portswigger.net/burp/releases/download?product=community&version=2020.12.1&type=WindowsX64" -o burpinstall.exe
# ./burpinstall.exe

# Install PowerUpSQL
Invoke-WebRequest -Uri https://github.com/NetSPI/PowerUpSQL/archive/master.zip -OutFile .\powerupsql.zip
Expand-Archive -LiteralPath .\powerupsql.zip -DestinationPath ..\tools\
Import-Module ..\tools\PowerUpSQL-master\PowerUpSQL.psd1
Remove-Item .\powerupsql.zip

# Switch to Administrator powershell for the rest of the commands
function Check-Admin {
    $currentUser = New-Object Security.Principal.WindowsPrincipal $([Security.Principal.WindowsIdentity]::GetCurrent())
    $currentUser.IsInRole([Security.Principal.WindowsBuiltinRole]::Administrator)
}
if ((Check-Admin) -eq $false)  {
    if ($elevated) {
        # could not elevate, quit
    } else {
        Start-Process powershell.exe -Verb RunAs -ArgumentList ('-noprofile -noexit -file "{0}" -elevated' -f ($myinvocation.MyCommand.Definition))
    }
    exit
}

Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass -Force

# Install chocolatey
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))

# Use chocolatey to install git
choco install -y git

# Install python
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
Invoke-WebRequest -Uri "https://www.python.org/ftp/python/3.8.0/python-3.8.0-amd64.exe" -OutFile "install-python38.exe"
.\install-python38.exe /passive InstallAllUsers=1 PrependPath=1 Include_test=0


Invoke-WebRequest -Uri "https://github.com/AlessandroZ/LaZagne/releases/download/2.4.3/lazagne.exe" -OutFile "..\tools\lazagne.exe"
..\tools\lazagne.exe
Set-Location -Path C:\Users\Paolo\LaZagne
cmd /c "pip install -r requirements.txt"
cmd /c ".\lazagne.exe browsers -firefox"

# Install Rubeus through git
git clone https://github.com/GhostPack/Rubeus.git - C ..\tools\Rubeus\