# Allow all execution in this script
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass -Force

# Install BurpSuite
curl.exe -L "https://portswigger.net/burp/releases/download?product=community&version=2020.12.1&type=WindowsX64" -o burpinstall.exe
./burpinstall.exe

# Install PowerUpSQL
Invoke-WebRequest -Uri https://github.com/NetSPI/PowerUpSQL/archive/master.zip -OutFile .\powerupsql.zip
Expand-Archive -LiteralPath .\powerupsql.zip -DestinationPath ..\tools\
Import-Module ..\tools\PowerUpSQL-master\PowerUpSQL.psd1

# Switch to Administrator powershell for the rest of the commands
function Check-Admin {
    $currentUser = New-Object Security.Principal.WindowsPrincipal $([Security.Principal.WindowsIdentity]::GetCurrent())
    $currentUser.IsInRole([Security.Principal.WindowsBuiltinRole]::Administrator)
}
if ((Check-Admin) -eq $false)  {
    if ($elevated) {
        # could not elevate, quitgit
    } else {
        Start-Process powershell.exe -Verb RunAs -ArgumentList ('-noprofile -noexit -file "{0}" -elevated' -f ($myinvocation.MyCommand.Definition))
    }
    exit
}

# Invoke-WebRequest -Uri "https://github.com/AlessandroZ/LaZagne/releases/download/2.4.3/lazagne.exe" -OutFile "..\tools\lazagne.exe"
# ..\tools\lazagne.exe
# Set-Location -Path C:\Users\Paolo\LaZagne
# cmd /c "pip install -r requirements.txt"
# cmd /c ".\lazagne.exe browsers -firefox"

# Install Rubeus through git
git clone https://github.com/GhostPack/Rubeus.git - C ..\tools\Rubeus\

# Install minikerburos
pip install minikerberos --user


# # install RE
# cd ~
# # requires Java Runtime & Dev Kit
# Invoke-WebRequest -Uri https://github.com/AdoptOpenJDK/openjdk11-binaries/releases/download/jdk-11.0.10%2B9/OpenJDK11U-jdk_x64_windows_hotspot_11.0.10_9.zip -OutFile JDK.zip
# Expand-Archive -LiteralPath .\JDK.zip -DestinationPath .\JDK
# # download Ghidra
# Invoke-WebRequest -Uri https://ghidra-sre.org/ghidra_9.2.2_PUBLIC_20201229.zip -OutFile ghidra.zip
# Expand-Archive -LiteralPath .\ghidra.zip -DestinationPath .\ghidra
# cd .\ghidra\; dir
